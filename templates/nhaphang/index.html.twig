<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}My Symfony Project{% endblock %}</title>
        <link rel="stylesheet" href="{{ asset('css/trangchu.css') }}"> <!-- Liên kết tệp CSS mới -->
        <link rel="stylesheet" href="{{ asset('css/nhaphang.css') }}"> <!-- Liên kết tệp CSS mới -->

</head>
<body>
    <header>
        <nav>
        <ul>
            <li><a href="index.php" title="Trang chủ">Hệ thống</a>
                <ul>
                    <li><a href="{{ path('danh_sach_nhan_vien') }}">Danh sách nhân viên</a></li>
                    <li><a href="{{ path('danh_sach_benh_nhan') }}">Danh sách bệnh nhân</a></li>
                    <li><a href="{{ path('login') }}">Đăng xuất</a></li>

                </ul>
            </li>

            <li><a href="{{ path('nhap_xuat') }}" title="Giới thiệu">Nhập xuất</a>
                <ul>
                    <li><a href="{{ path('ban_hang') }}">Bán hàng</a></li>
                    <li><a href="{{ path('ban_hang_cat_lieu') }}">Bán hàng cắt liều</a></li>
                    <li><a href="{{ path('don_lieu_mau') }}" title="Sản xuất phần mềm">Đơn/Liều mẫu</a></li>
                    <li><a href="{{ path('nhap_hang') }}">Nhập hàng</a></li>
                    <li><a href="{{ path('don_dat_hang_online') }}">Đơn đặt hàng online</a></li>
                </ul>
            </li>


            <li><a href="{{ path('thu_chi') }}" title="Khóa học chuyên đề">Thu - chi</a>
                <ul>
                <li><a href="{{ path('danh_sach_phieu_nhap') }}">Danh sách phiếu nhập</a></li>
                <li><a href="{{ path('danh_sach_phieu_xuat') }}">Danh sách phiếu xuất</a></li>
                <li><a href="{{ path('lich_su_giao_dich') }}" title="Sản xuất phần mềm">Lịch sử giao dịch</a></li>
                </ul>
            </li>

            <li><a href="{{ path('hang_hoa') }}" title="Dịch vụ">Hàng hóa</a>
                <ul>
                <li><a href="{{ path('danh_sach_thuoc') }}" title="Danh sách thuốc">Danh sách thuốc</a></li>
                    <li><a href="{{ path('them_thuoc_moi') }}" title="Sản xuất phần mềm">Thêm thuốc mới</a></li>
                    <li><a href="{{ path('kiem_ke_kho') }}" title="Sản xuất phần mềm">Kiểm kê kho</a></li>
                    <li><a href="{{ path('thong_ke_doanh_thu') }}" title="Sản xuất phần mềm">Thống kê doanh thu</a></li>



                </ul>
            </li>
            <li><a href="{{ path('doi_tac') }}" title="Liện hệ">Đối tác</a></li>
            <li><a href="{{ path('bao_cao') }}" title="Liện hệ">Báo cáo</a></li>
            <li><a href="{{ path('tien_ich') }}" title="Liện hệ">Tiện ích</a></li>
            <li><a href="{{ path('tro_giup') }}" title="Liện hệ">Trợ giúp</a></li>
        </ul>
    </nav>

<div class="nhaphang">
    <h1>Nhập hàng hóa</h1>
    <div class="formnhaphang">

       <form action="/nhap-hang" method="post">
    <fieldset>
        <legend>Thông tin nhà phân phối</legend>
        <label for="ma-hang">Nhà phân phối</label>
        <select id="ma-hang" name="MaNPP">
            {% for row in nhaPhanPhoiData %}
                <option value="{{ row.MaNPP }}">{{ row.TenNPP }}</option>
            {% endfor %}
        </select>
    </fieldset>

    <fieldset>
        <legend>Thông tin thuốc</legend>
        <label for="ma-thuoc">Tên Thuốc</label>
        <select id="ma-thuoc" name="idThuoc">
            {% for row in thuocData %}
                <option value="{{ row.idThuoc }}">{{ row.TenThuoc }} (Còn lại: {{ row.SoLuong }})</option>
            {% endfor %}
        </select>
        <div id="gia-ban"></div>
    </fieldset>

    <fieldset>
        <legend>Thông tin giao dịch</legend>
        <label for="nguoi-giao">Người giao</label>
        <input type="text" id="nguoi-giao" name="NguoiGiao">

        <label for="nguoi-nhan">Người nhận</label>
        <select id="nguoi-nhan" name="NguoiNhan">
            {% for row in benhnhanData %}
                <option value="{{ row.HoTen }}">{{ row.HoTen }}</option>
            {% endfor %}
        </select>

        <label for="so-luong-nhap">Số lượng nhập</label>
        <input type="number" id="so-luong-nhap" name="SoLuongNhap" onchange="tinhTongTien()">

        <label for="gia-nhap">Giá Nhập</label>
        <input type="number" id="gia-nhap" name="GiaNhap" onchange="tinhTongTien()">

        <label for="tong-tien-hoa-don">Tổng tiền hóa đơn</label>
        <input type="number" id="tong-tien-hoa-don" name="TongTienHD">

        <label for="ngay-nhap">Ngày nhập</label>
        <input type="date" id="ngay-nhap" name="NgayNhap" value="{{ "now"|date('Y-m-d') }}">
    </fieldset>

    <input type="submit" value="Submit">
    <input type="reset" value="Reset">
</form>

    </div>
</div>

{% for message in app.flashes('success') %}
    <div class="alert alert-success">
        {{ message }}
    </div>
{% endfor %}

{% for message in app.flashes('error') %}
    <div class="alert alert-danger">
        {{ message }}
    </div>
{% endfor %}



{% block javascripts %}
    <script src="{{ asset('js/nhaphang.js') }}"></script>
    <script>
        function updateGiaBan() {
            document.getElementById("ma-thuoc").addEventListener("change", function() {
                var idThuoc = this.value;
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var giaBan = parseFloat(this.responseText);
                        var giaNhap = parseFloat(document.getElementById("gia-nhap").value);

                        if (giaNhap > giaBan) {
                            // Hiển thị thông báo hoặc thực hiện các hành động khác
                            alert("Giá nhập phải nhỏ hơn hoặc bằng giá bán!");
                        } else {
                            document.getElementById("gia-ban").innerHTML = "Giá bán: " + giaBan;
                        }
                    }
                };

                // Sử dụng đường dẫn của Symfony để gửi yêu cầu XMLHttpRequest
                xmlhttp.open("GET", "{{ path('get_giaban') }}?idThuoc=" + idThuoc, true);
                xmlhttp.send();
            });
        }

        window.onload = updateGiaBan;
    </script>
{% endblock %}

    
    </header>
    <main>
        {% block content %}{% endblock %}
    </main>
</body>
</html>
